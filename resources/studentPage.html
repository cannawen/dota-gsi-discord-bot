<html>
    <head>
        <title>Private Coaching</title>
        <script>
            function fetchAndPlay() {
                return fetch("./poll")
                    .then((res) => res.json())
                    .then((res) => {
                        return new Promise((resolve) => {
                            if (res[0]) {
                                const f = new Audio("/" + res[0]);
                                f.addEventListener("ended", resolve);
                                f.play();
                            } else {
                                resolve();
                            }
                        });
                    });
            }

            function loop() {
                try {
                    fetchAndPlay().then(() => setTimeout(loop, 500));
                } catch (error) {
                    loop();
                }
            }

            function startCoaching(e) {
                e.target.remove();
                document.getElementById("coaching").style.display = "block";
                loop();
            }
        </script>
    </head>
    <body>
        <button onClick="startCoaching(event)">START COACHING</button>
        <div id="coaching" style="display: none">Coaching...</div>
    </body>
</html>
